// client/src/components/Common.jsx
import React from 'react';
// --- ADD THESE IMPORTS ---
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';
import { Bar } from 'react-chartjs-2';

// Register ChartJS components
ChartJS.register(
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend
);

// --- Card Container ---
export const DashboardCard = ({ children, className = "" }) => (
  <div className={`bg-white/60 backdrop-blur-xl p-6 rounded-2xl shadow-lg border border-white/50 ${className}`}>
    {children}
  </div>
);

// --- Input Field ---
export const Input = ({ name, type, placeholder, icon, value, onChange, required = false }) => (
  <div className="relative">
    <span className="absolute left-0 top-0 h-full w-12 flex items-center justify-center pl-3 text-gray-400">
      <i className={`fas ${icon}`}></i>
    </span>
    <input
      name={name}
      type={type}
      placeholder={placeholder}
      value={value}
      required={required}
      onChange={onChange}
      className="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:border-sky-500 focus:ring-2 focus:ring-sky-200 outline-none transition-all bg-gray-50/50"
    />
  </div>
);

// --- Loading Spinner ---
export const LoadingSpinner = () => (
  <div className="flex justify-center items-center p-10">
    <i className="fas fa-spinner fa-spin fa-3x text-sky-500"></i>
  </div>
);

// --- Status Pill (for tables) ---
export const StatusPill = ({ text, color }) => {
  const colors = {
    green: 'bg-green-100 text-green-800',
    yellow: 'bg-yellow-100 text-yellow-800',
    red: 'bg-red-100 text-red-800',
    blue: 'bg-sky-100 text-sky-800',
    gray: 'bg-gray-100 text-gray-800'
  };
  return (
    <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[color] || colors.gray}`}>
      {text}
    </span>
  );
};

// --- Tab Button ---
export const TabButton = ({ label, icon, isActive, onClick }) => (
  <button
    onClick={onClick}
    className={`flex-1 px-4 py-3 text-sm font-semibold text-center transition-colors duration-200 rounded-lg whitespace-nowrap ${
      isActive ? 'bg-white/70 text-sky-700 shadow-md' : 'text-gray-600 hover:bg-white/50'
    }`}
  >
    <i className={`fas ${icon} mr-2 hidden sm:inline`}></i>
    {label}
  </button>
);

// --- Stat Card ---
export const StatCard = ({ title, value, icon, color }) => (
  <DashboardCard>
    <div className={`text-3xl mb-2 ${color}`}>
      <i className={`fas ${icon}`}></i>
    </div>
    <p className="text-gray-600 text-sm font-medium">{title}</p>
    <p className="text-2xl font-bold text-gray-900">{value}</p>
  </DashboardCard>
);

// --- Progress Bar ---
export const ProgressBar = ({ value, colorClass = 'bg-sky-500' }) => (
  <div className="w-full bg-gray-200 rounded-full h-2.5 mt-2">
    <div
      className={`${colorClass} h-2.5 rounded-full transition-all duration-500`}
      style={{ width: `${value}%` }}
    ></div>
  </div>
);

// --- ADD THIS COMPONENT: SimpleBarChart ---
export const SimpleBarChart = ({ data, title, barColorClass }) => {
    // Convert 'bg-green-500' class to actual hex color if needed, or stick to a default
    // ChartJS needs hex/rgba colors, not tailwind classes
    const colorMap = {
        'bg-green-500': 'rgba(34, 197, 94, 0.7)',
        'bg-sky-500': 'rgba(14, 165, 233, 0.7)',
        'bg-red-500': 'rgba(239, 68, 68, 0.7)',
    };
    const bg = colorMap[barColorClass] || 'rgba(54, 162, 235, 0.5)';

    const chartData = {
        labels: data.map(d => d.label),
        datasets: [
            {
                label: title,
                data: data.map(d => d.value),
                backgroundColor: bg,
            },
        ],
    };

    const options = {
        responsive: true,
        plugins: {
            legend: { display: false },
            title: { display: !!title, text: title },
        },
    };

    return (
        <DashboardCard>
            <h3 className="font-bold text-lg text-gray-900 mb-4">{title}</h3>
            <Bar data={chartData} options={options} />
        </DashboardCard>
    );
};